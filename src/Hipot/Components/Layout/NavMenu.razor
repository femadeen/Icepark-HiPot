@using Hipot.Data
@using Hipot.Data.Core.Models
@using Hipot.Components.Shared

@inject AppState AppState
@inject NavigationManager NavigationManager

<div class="top-nav">
    <div class="nav-brand">
        <span class="nav-title">Icepark-HiPot</span>
    </div>

    <div class="nav-links">
        <a class="nav-link @(IsActive("/") ? "active" : "")" href="/">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
            </svg>
            <span>Home</span>
        </a>

        <a class="nav-link @(IsActive("/about") ? "active" : "")" href="/about">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
            </svg>
            <span>About</span>
        </a>

        @if (AppState.CurrentUser != null)
        {
            <button class="logout-button" @onclick="Logout">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                </svg>
                <span>Logout</span>
            </button>
        }
        <button class="exit-button" @onclick="() => ShowExitConfirmation = true">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
            <span>Exit</span>
        </button>
    </div>
</div>

@if (ShowExitConfirmation)
{
    <MessageBoxPanel Title="Exit Confirmation"
                     Message="Are you sure you want to exit?"
                     Buttons="MessageBoxButtons.YesNo"
                     OnYesClicked="ExitApplication"
                     OnNoClicked="() => ShowExitConfirmation = false" />
}


<style>
    .top-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .nav-links {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .exit-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 12px;
        background: linear-gradient(135deg, #64748b, #475569);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
</style>

@code {
    private bool ShowExitConfirmation { get; set; }

    private void Logout()
    {
        AppState.CurrentUser = null;
        NavigationManager.NavigateTo("/login");
    }

    private void ExitApplication()
    {
        Application.Current.Quit();
    }

    private bool IsActive(string path)
    {
        return NavigationManager.ToBaseRelativePath(NavigationManager.Uri) == path.Trim('/');
    }
}
